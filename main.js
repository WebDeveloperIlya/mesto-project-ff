(()=>{"use strict";var t=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""},e=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled=!0)};function n(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);e(r,c,o),r.forEach((function(e){t(n,e,o)}))}function o(t){"Escape"===t.key&&u(document.querySelector(".popup_is-opened"))}function r(t){t.target.classList.contains("popup_is-opened")&&u(t.target)}function c(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o),document.addEventListener("click",r)}function u(t){document.removeEventListener("keydown",o),document.removeEventListener("click",r),t.classList.remove("popup_is-opened")}var a=document.querySelector(".places__list"),i=document.querySelector("#card-template").content,s=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),p=document.querySelector(".popup__input_type_name"),d=document.querySelector(".popup__input_type_description"),_=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),m=document.querySelector(".popup__input_type_card-name"),v=document.querySelector(".popup__input_type_url"),y=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__image"),k=document.querySelector(".popup__caption"),q=document.querySelector(".popup__form-edit"),C=document.querySelector(".popup__form-card"),g=document.querySelector(".popup__close"),E=document.querySelector(".popup__close-image"),L=document.querySelector(".card__delete-button"),x=document.querySelector(".profile__avatar"),j=document.querySelector(".popup_type_new-avatar"),P=document.querySelector(".popup__close-avatar"),B=document.querySelector(".popup__input_type_avatar"),A={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"b13f5d37-5775-4f5a-b71e-05763fae6d5e","Content-Type":"application/json"}};function U(t,e){t.target.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:A.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))}(e).then((function(e){t.target.classList.remove("card__like-button_is-active"),document.querySelector(".countLikes").textContent=e.likes.length})).catch((function(t){return console.log("Ошибка.....: ".concat(t))})):function(t){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:A.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))}(e).then((function(e){t.target.classList.add("card__like-button_is-active"),document.querySelector(".countLikes").textContent=e.likes.length})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))}function w(t,e){(function(t,e){return fetch("".concat(A.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:A.headers}).then((function(t){return e.target.closest(".card").remove(),t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))})(e,t).then((function(){t.target.closest(".card").remove()})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))}function D(t,e,n,o,r,c,u,a){var s=i.cloneNode(!0),l=s.querySelector(".card__image"),p="bb65451046017648d2b9dec0",d=s.querySelector(".card__delete-button");return l.src=n,l.alt=o,s.querySelector(".card__title").textContent=o,r.some((function(t){return t._id===p}))&&s.querySelector(".card__like-button").classList.add("card__like-button_is-active"),s.querySelector(".card__like-button").addEventListener("click",(function(t){u(t,e)})),s.querySelector(".countLikes").textContent=r.length,l.addEventListener("click",(function(){return a(n,o)})),t!==p?d.remove():d.addEventListener("click",(function(){return d.addEventListener("click",(function(e){c(e,t)}))})),s}function T(t,e){b.src=t,b.alt=e,k.textContent=e,c(S)}x.addEventListener("click",(function(t){t.preventDefault(),c(j),n(document.querySelector(".popup__form-avatar"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"})})),s.addEventListener("click",(function(){p.value=_.textContent,d.value=f.textContent,c(y),n(q,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"})})),l.addEventListener("click",(function(){c(h),n(C,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"})})),P.addEventListener("click",(function(){u(j)})),g.addEventListener("click",(function(){u(y)})),E.addEventListener("click",(function(){u(S)})),L.addEventListener("click",(function(){u(h)})),q.addEventListener("submit",(function(t){!function(t){var e,n;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=p.value,n=d.value,fetch("".concat(A.baseUrl,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))).then((function(t){_.textContent=p.value,f.textContent=d.value,u(y)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Сохранить"}))}(t)})),document.querySelector(".popup__form-avatar").addEventListener("submit",(function(t){!function(t,e){var n;t.preventDefault(),t.submitter.textContent="Сохранение...",(n=e,fetch("".concat(A.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))).then((function(t){console.log(t),x.style.background="url(".concat(t.avatar,")"),u(j)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Создать"}))}(t,B.value)})),C.addEventListener("submit",(function(t){!function(t){t.preventDefault(),t.submitter.textContent="Сохранение...",function(t){return fetch("".concat(A.baseUrl,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))}({name:m.value,link:v.value}).then((function(t){a.prepend(D(t.owner._id,t._id,t.link,t.name,t.likes,w,U,T)),u(h)})).catch((function(t){return console.log(t)})).finally((function(){t.submitter.textContent="Создать"}))}(t)})),Promise.all([fetch("".concat(A.baseUrl,"/users/me"),{headers:A.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("".concat(A.baseUrl,"/cards"),{headers:A.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log("Ошибка.....: ".concat(t))}))]).then((function(t){console.log(t),_.textContent=t[0].name,f.textContent=t[0].about,x.style.background="url(".concat(t[0].avatar,")"),t[1].forEach((function(t){var e=D(t.owner._id,t._id,t.link,t.name,t.likes,w,U,T);document.querySelector(".places__list").append(e)}))})).catch((function(t){console.log(t)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()}))})),function(n){Array.from(document.querySelectorAll(n.formSelector)).forEach((function(o){!function(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);e(r,c,o),r.forEach((function(u){u.addEventListener("input",(function(){e(r,c,o),function(e,n,o){n.validity.valid?t(e,n,o):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),console.log(n)}(e,n,n.validationMessage,o),n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity("")}(n,u,o)}))}))}(o,n)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"})})();