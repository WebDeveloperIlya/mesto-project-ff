(()=>{"use strict";var e=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""},t=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};function n(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);t(r,c,o),r.forEach((function(t){e(n,t,o)}))}function o(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function r(e){e.target.classList.contains("popup_is-opened")&&u(e.target)}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o),document.addEventListener("click",r)}function u(e){document.removeEventListener("keydown",o),document.removeEventListener("click",r),e.classList.remove("popup_is-opened")}var a=document.querySelector(".places__list"),i=document.querySelector("#card-template").content,s=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),d=document.querySelector(".popup__input_type_name"),p=document.querySelector(".popup__input_type_description"),f=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),m=document.querySelector(".popup__input_type_card-name"),y=document.querySelector(".popup__input_type_url"),v=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__image"),q=document.querySelector(".popup__caption"),k=document.querySelector(".popup__form-edit"),L=document.querySelector(".popup__form-card"),g=document.querySelector(".popup__close"),E=document.querySelector(".popup__close-image"),C=document.querySelector(".card__delete-button"),x=document.querySelector(".profile__avatar"),j=document.querySelector(".popup_type_new-avatar"),P=document.querySelector(".popup__close-avatar"),A=document.querySelector(".popup__input_type_avatar"),U={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"b13f5d37-5775-4f5a-b71e-05763fae6d5e","Content-Type":"application/json"}};function w(e,t){e.target.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(t){e.target.classList.remove("card__like-button_is-active"),e.target.closest(".card").querySelector(".countLikes").textContent=t.likes.length})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})):function(e){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(t){e.target.classList.add("card__like-button_is-active"),e.target.closest(".card").querySelector(".countLikes").textContent=t.likes.length})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}))}function T(e,t){(function(e,t){return fetch("".concat(U.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:U.headers}).then((function(e){return t.target.closest(".card").remove(),e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(t,e).then((function(){e.target.closest(".card").remove()})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}))}function B(e,t,n,o,r){var c=i.cloneNode(!0),u=c.querySelector(".card__image"),a=c.querySelector(".card__delete-button"),s=t.owner._id,l=t._id,d=t.likes,p=t.name,f=t.link;return u.src=f,u.alt=p,c.querySelector(".card__title").textContent=p,d.some((function(t){return t._id===e}))&&c.querySelector(".card__like-button").classList.add("card__like-button_is-active"),c.querySelector(".card__like-button").addEventListener("click",(function(e){o(e,l)})),c.querySelector(".countLikes").textContent=d.length,u.addEventListener("click",(function(){return r(f,p)})),s!==e?a.remove():a.addEventListener("click",(function(){return a.addEventListener("click",(function(e){n(e,l)}))})),c}var D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function N(e,t){b.src=e,b.alt=t,q.textContent=t,c(S)}x.addEventListener("click",(function(e){e.preventDefault(),c(j),n(document.querySelector(".popup__form-avatar"),D)})),s.addEventListener("click",(function(){d.value=f.textContent,p.value=_.textContent,c(v),n(k,D)})),l.addEventListener("click",(function(){c(h),n(L,D)})),P.addEventListener("click",(function(){u(j)})),g.addEventListener("click",(function(){u(v)})),E.addEventListener("click",(function(){u(S)})),C.addEventListener("click",(function(){u(h)})),k.addEventListener("submit",(function(e){!function(e){var t,n;e.submitter.textContent="Сохранение...",(t=d.value,n=p.value,fetch("".concat(U.baseUrl,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){!function(e,t){f.textContent=e,_.textContent=t}(e.name,e.about),u(v)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"})),k.reset()}(e)})),document.querySelector(".popup__form-avatar").addEventListener("submit",(function(e){!function(e,t){var n;e.submitter.textContent="Сохранение...",(n=t,fetch("".concat(U.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),x.style.background="url(".concat(e.avatar,")"),u(j)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Создать"})),document.querySelector(".popup__form-avatar").reset()}(e,A.value)})),L.addEventListener("submit",(function(e){!function(e){e.submitter.textContent="Сохранение...",function(e){return fetch("".concat(U.baseUrl,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}({name:m.value,link:y.value}).then((function(e){a.prepend(B(e.owner._id,e,T,w,N)),u(h)})).catch((function(e){return console.log(e)})).finally((function(){e.submitter.textContent="Создать"})),L.reset()}(e)})),Promise.all([fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(U.baseUrl,"/cards"),{headers:U.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){console.log(e[0]),f.textContent=e[0].name,_.textContent=e[0].about,x.style.background="url(".concat(e[0].avatar,")"),console.log(e[1]),e[1].forEach((function(t){var n=B(e[0]._id,t,T,w,N);document.querySelector(".places__list").append(n)}))})).catch((function(e){console.log(e)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()}))})),function(n){Array.from(document.querySelectorAll(n.formSelector)).forEach((function(o){!function(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);t(r,c,o),r.forEach((function(u){u.addEventListener("input",(function(){t(r,c,o),function(t,n,o){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?e(t,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),console.log(n)}(t,n,n.validationMessage,o)}(n,u,o)}))}))}(o,n)}))}(D)})();